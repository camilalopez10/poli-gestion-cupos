<div class="wrap">
  <h1>Gestión de Aulas</h1>

  <!-- Form to create a new aula -->
  <section class="create-aula" style="margin-top:16px; border:1px solid #eee; padding:12px; border-radius:6px;">
    <h2>Crear nueva aula</h2>
    <div class="grid">
      <div>
        <label for="new-nombre">Nombre</label>
        <input id="new-nombre" [(ngModel)]="newAula.nombre" name="newNombre" />
      </div>
      <div>
        <label for="new-cap">Capacidad</label>
        <input id="new-cap" type="number" min="1" step="1" [(ngModel)]="newAula.capacidad" name="newCap" />
      </div>
      <div>
        <label for="new-ubic">Ubicación</label>
        <input id="new-ubic" [(ngModel)]="newAula.ubicacion" name="newUbic" />
      </div>
    </div>
    <div style="margin-top:8px;">
      <button class="btn primary" (click)="createAula()"
        [disabled]="!newAula.nombre || !newAula.ubicacion || newAula.capacidad === null || newAula.capacidad === undefined || ('' + newAula.capacidad).trim() === '' || isSaving">
        Crear aula
      </button>
      <button class="btn" (click)="clearNewAula()" type="button">Limpiar Campos</button>
    </div>
    <!-- validation messages moved to toasts shown when user attempts to create -->
  </section>
  <form (ngSubmit)="onSearch()">
    <div>
      <div>
        <label for="nombre">Nombre</label>
        <input id="nombre" name="nombre" [(ngModel)]="nombre" />
      </div>
      <div>
        <button class="btn" type="submit">Buscar</button>
        <button class="btn" (click)="fetchAulas()" [disabled]="loading" type="button">Refrescar <span *ngIf="loading"
            class="spinner" aria-hidden></span></button>

      </div>
    </div>
  </form>
  <table style="margin-top:12px; width:100%">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Capacidad</th>
        <th>Ubicación</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let a of items">
        <td>
          <ng-container *ngIf="editingId !== (a.id || a.id_aula).toString(); else editNombre">{{ a.nombre
            }}</ng-container>
          <ng-template #editNombre>
            <input [(ngModel)]="editModel.nombre" />
          </ng-template>
        </td>
        <td>
          <ng-container *ngIf="editingId !== (a.id || a.id_aula).toString(); else editCap">{{ a.capacidad
            }}</ng-container>
          <ng-template #editCap>
            <input type="number" [(ngModel)]="editModel.capacidad" />
          </ng-template>
        </td>
        <td>
          <ng-container *ngIf="editingId !== (a.id || a.id_aula).toString(); else editUb">{{ a.ubicacion
            }}</ng-container>
          <ng-template #editUb>
            <input [(ngModel)]="editModel.ubicacion" />
          </ng-template>
        </td>
        <td>
          <ng-container *ngIf="editingId !== (a.id || a.id_aula).toString(); else editActions">
            <button (click)="startEdit(a)">Editar</button>
            <button (click)="eliminar((a.id || a.id_aula).toString())">Eliminar</button>
          </ng-container>
          <ng-template #editActions>
            <button (click)="acceptEdit()"
              [disabled]="isSaving || !editModel.nombre || !editModel.ubicacion || editModel.capacidad === null || editModel.capacidad === undefined || ('' + editModel.capacidad).trim() === '' || (+editModel.capacidad) <= 0">
              Aceptar <span *ngIf="isSaving" class="spinner" aria-hidden></span>
            </button>
            <button (click)="cancelEdit()">Cancelar</button>
          </ng-template>
        </td>
      </tr>
      <tr *ngIf="items.length === 0">
        <td colspan="5">No hay aulas</td>
      </tr>
    </tbody>
  </table>
</div>

<div class="toast" *ngIf="toastMessage">{{ toastMessage }}</div>